{include file="public/header" /}
<script src="__ROOT__/js/additbox.js"></script>
<div class="container-fluid">
    <!-- 面包屑 -->
    <ol class="breadcrumb">
        <li><a href="#">菜单管理</a></li>
        <li class="active">菜单列表</li>
    </ol>
    <!-- 按钮 -->
    <div class="row buttons">
        <div class="col-md-2">
            <input class="form-control" type="text" placeholder="搜索名称" id="searchFieldName" value="{$Request.param.name}">
        </div>
        <div class="col-md-2" align="left">
            <button class="btn btn-success" onclick="location.href = '{$defaultParams??'?'}&mobile='+$('#searchFieldMobile').val()+'&name='+$('#searchFieldName').val()+'';">搜索</button>
            <button class="btn btn-default" onclick="reload();">刷新</button>
        </div>
        <div class="col-md-8" align="right">
            <button class="btn btn-default" onclick="additbox.add();">添加菜单</button>
        </div>
    </div>

    <!-- 列表 -->
    <div class="row">
        <table class="table table-hover col-md-12">
            <thead>
                <tr>
                    <th>名称</th>
                    <th>图标</th>
                    <th>标识符</th>
                    <th>序号</th>
                    <th>备注</th>
                    <th>创建时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {:is_null($data.rows) || count($data.rows) == 0 ? '<tr><td colspan="7" class="no-data">暂无数据</td></tr>' : ''}
                {volist name="data.rows" id="row"}
                    <tr>
                        <td style="display:none;" id="tablerow_{$row.id}">
                            {$row|json_encode}
                        </td>
                        <td><a href="{$row.href}">{$row.name}</a></td>
                        <!-- <td><img class="img-50x50" src="{$row.icon??'__ROOT____NOPIC__'}" alt="{$row.name}" title="{$row.name}"/></td> -->
                        <td><i class="{$row.icon}" aria-hidden="true"></i></td>
                        <td>{$row.permission}</td>
                        <td>{$row.sort}</td>
                        <td class="text-overflow-ellipsis" style="max-width:120px;" title="{$row.remark}">{$row.remark}</td>
                        <td class="fromUnixtimestamp">{$row.create_time}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="additbox.edit('修改 - {$row.title}', $('#tablerow_{$row.id}').html());">修改</button>
                            <button class="btn btn-danger btn-sm" onclick="dis('{$row.id}', 1);">删除</button>
                        </td>
                    </tr>
                {/volist}
            </tbody>
        </table>
    </div>

    <table id="additbox" class="additbox">
        <tbody>
            <tr>
                <td class="">父菜单</td>
                <td><input type="text" class="form-control" name="pid" placeholder="" /></td>
            </tr>
            <tr>
                <td class="rqd">名称</td>
                <td><input type="text" class="form-control" name="name" placeholder="" /></td>
            </tr>
            <tr>
                <td class="">图标</td>
                <!-- <td title="点击修改">
                    <img class="img-50x50 icon-img" src="__ROOT____NOPIC__" style="cursor: pointer;" onclick="$('#additbox').find('.icon-file').trigger('click');" />
                    <input type="hidden" class="form-control" name="icon" placeholder="" />
                    <input style="display: none;" type="file" class="form-control icon-file" onchange="var iconfileThis = this; uploadFile(iconfileThis, function(src){$(iconfileThis).prev().val(src);$(iconfileThis).prev().prev().attr('src', src);});" /> -->
                <td>
                    <input type="text" class="form-control" name="icon" placeholder="" />
                </td>
            </tr>
            <tr>
                <td class="">链接</td>
                <td><input type="text" class="form-control" name="href" placeholder="" /></td>
            </tr>
            <tr>
                <td class="">标识符</td>
                <td><input type="text" class="form-control" name="remark" placeholder="" /></td>
            </tr>
            <tr>
                <td class="">序号</td>
                <td><input type="text" class="form-control" name="sort" placeholder="" /></td>
            </tr>
            <tr>
                <td class="">是否显示</td>
                <td>
                    <select class="form-control" name="hidden">
                        <option value="0">显示</option>
                        <option value="1">隐藏</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="">备注</td>
                <td><input type="text" class="form-control" name="remark" placeholder="" /></td>
            </tr>
            <tr>
                <td colspan="2">
                    <input type="hidden" class="form-control" name="id" />
                    <button class="btn btn-primary" onclick="additbox.save();">确定</button>
                    <button class="btn btn-danger" onclick="additbox.hideAdditbox();">取消</button>
                </td>
            </tr>
        </tbody>
    </table>
    <script>
        var additbox = initAdditbox({
            box:            $('#additbox'),
            width:          '800px',
            height:         '470px',
            addURL:         'add.html?ajax',
            addTitle:       '添加菜单',
            editURL:        'edit.html?ajax',
            /* beforeAdd:      function(options){
                var box = options.box;
                box.find('.icon-img').attr('src', '__ROOT____NOPIC__');
                return true;
            },
            beforeEdit:     function(options, title, data){
                options.box.find('.icon-img').attr('src', data['icon']);
                return true;
            } */
        });

        function dis(id, disabled){
            layer.confirm('确定删除?', {btn: ['确认', '取消']}, function(){
                $.ajax({
                    url: 'dis.html?ajax',
                    data: {
                        id:         id,
                        disabled:   disabled
                    },
                    succeeded: function(data){
                        reload();
                        return true;
                    }
                });
            });
        }
    </script>

</div>
{include file="public/footer" /}