<!DOCTYPE html>
<html lang="zh">
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>{$title??'自个主页'}</title>

		<!-- jQuery -->
		<script src="__ROOT__/static/jquery/dist/jquery.min.js"></script>
        <script src="__ROOT__/static/jquery-qrcode/jquery-qrcode.min.js"></script>
		<!-- Bootstrap -->
		<link href="__ROOT__/static/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="__ROOT__/static/bootstrap/dist/js/bootstrap.min.js"></script>
		<!-- Font Awesome -->
		<link href="__ROOT__/static/font-awesome/css/font-awesome.min.css" rel="stylesheet">
		<!-- Layui -->
		<link rel="stylesheet" href="__ROOT__/static/layui/css/layui.css" media="all">
		<script src="__ROOT__/static/layui/layui.all.js"></script>
		<!-- jquery.typeahead -->
		<link rel="stylesheet" href="__ROOT__/static/jquery-typeahead-2.10.4/dist/jquery.typeahead.min.css" media="all">
		<script src="__ROOT__/static/jquery-typeahead-2.10.4/dist/jquery.typeahead.min.js"></script>

		<!-- jQuery.typeahead样式修正 -->
		<style>
			.typeahead__container{
				display: inline-block;
				width: 100%;
			}
			.typeahead__container input{
				border-radius: 7px !important;
				border-color: rgb(149,149,149);
			}
			.typeahead__item{
				text-align: center;
				font-size: 14px;
			}
			.typeahead__empty{
				text-align: center;
				cursor: default;
			}
		</style>
        <!-- bootstrap样式修正 -->
        <style>
            .table > tbody > tr > td{
                vertical-align: middle;
            }
			[role=navigation]{
				margin-left: -15px;
        		margin-right: -15px;
        		margin-bottom: 0px;
			}
        </style>
		<!-- 自定义样式 -->
        <style>
            body{
                margin: 0px;
                padding: 0px;
                font-size: 14px;
            }
            .buttons{
                padding: 5px 10px;
            }
            .table .no-data{
                font-size: 15px;
                text-align: center;
                cursor: default;
            }
            .table .text-overflow-ellipsis{
                text-overflow: ellipsis;
				white-space: nowrap;
                overflow: hidden;
            }
            .rqd::after{
                content: "*";
                vertical-align: middle;
                color: red;
            }
            .additbox{
                display: none;
                width: 100%;
                min-width: 500px;
            }
            .additbox > tbody > tr > td{
                padding: 10px 20px 0px 20px;
            }
            .additbox > tbody > tr > td:first-child{
                table-layout: fixed;
                max-width: 200px;
                text-align: left;
            }
            .additbox > tbody > tr:last-child > td{
                padding-top: 20px; 
                text-align: center;
            }
            .additbox > tbody > tr:last-child > td > button{
                width: 150px;
                margin: 0px 10px;
            }
        </style>

		<!-- 自定义方法 -->
		<script>
			// 设置一个默认的提示消息
			var layer = layer ? layer : {};
				layer.syserror = function(){
				layer.alert('系统错误, 请联系运维人员或开发人处理!', {icon: 5});
			}

			// 设置默认的ajax请求参数
			$.ajaxSetup({
				type: 'post',
				dataType: 'json',
				global: true,
				success: function(data){
					if(!this.noneCheck()){
						if(data && data.result === 1){
							this.succeeded(data);
						}else{
							if(!this.failed(data)) layer.alert(data.message, {icon: 2});
						}
					}
				},
				error: function(e){
					layer.syserror();
				},
				beforeSend: function(XHR){
					this.loaderLayer = layer.load(2);
					this._beforeSend(XHR);
				},
				_beforeSend: function(XHR){

				},
				complete: function(XHR, TS){
					layer.close(this.loaderLayer);
					this._complete(XHR, TS);
				},
				_complete: function(XHR, TS){

				},

				// 当返回的数据中的result为1时回调
				succeeded: function(data){
					return true;
				},
				// 当返回的数据中的result不为1时回调
				failed: function(data){
					return false;
				},
				// 不自动检查, 直接回调; 只有return true时才不会自动检查
				noneCheck: function(data){
					return false;
				}
			});

			$(function(){
				// 将所有class包含fromUnixtimestamp的标签内的时间戳改成yyyy-MM-dd HH:mm:ss的时间
				$(".fromUnixtimestamp").each(function(index, item){
					try{
						var date = new Date($(item).html()*1000);
						$(item).html(getFormattedTime(date));
					}catch(e){
						log.error(e);
					}
				});
			});

			// 获取格式化后的时间
			function getFormattedTime(date){
				date = date ? date : new Date();
				return date.getFullYear()+"-"+(date.getMonth() < 9 ? '0' : '')+(date.getMonth()+1)+"-"+(date.getDate() < 10 ? '0' : '')+date.getDate()+" "+(date.getHours() < 10 ? '0' : '')+date.getHours()+":"+(date.getMinutes() < 10 ? '0' : '')+date.getMinutes()+":"+(date.getSeconds() < 10 ? '0' : '')+date.getSeconds();
			}

			// 带默认参数刷新页面
			function reload(){
				location.href = '{$Request.action}.html{$defaultParams??"?"}';
			}

			/**
			* 
			* @param input标签 input 文件input标签
			* @param Funtion callback 成功获取信息后的回调
			*/
			function uploadFile(input, callback){
				var formData = new FormData();
				formData.append("file", $(input)[0].files[0]);
				$.ajax({
					url: "__ROOT__/index.php/index/index/upload",
					data: formData,
					processData: false, 
					contentType: false,
					succeeded: function(data){
						if(callback instanceof Function) callback('__ROOT__' + data.data);
					}
				});
			}

			// 获取cookie
			function getCookie(name){
				var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
				if(arr = document.cookie.match(reg)) return unescape(arr[2]);
				else return null;
			}

			// 调用jQuery的fadeOut()后调用remove()
			function removeout(item, type, callback){
				$(item).fadeOut(type ? type : 'normal', function(){
					if(callback !== null && callback instanceof Function) callback();
					$(item).remove();
				});
			}

			// 自定制typeahead事项
			function initTypeahead(input, template, emptyTemplate, source, onClick){
				$.typeahead({
					input: input,
					minLength: 1,
					maxItem: 20,
					order: "asc",
					delay: 300,
					dynamic: true,
					cancelButton: false,
					template: template,
					emptyTemplate: emptyTemplate,
					source: source,
					callback: {
						onResult: function(node, query, result, resultCount, resultCountPerGroup){
							if(query != '') $(".typeahead__result").show();
						},
						onLayoutBuiltBefore: function(node, query, result, resultHtmlList){
							if(result.length > 0){
								resultHtmlList.find("li").each(function(index, item){
									$(item).removeAttr("disabled");
									$(item).append(`<data style="display: none;">`+JSON.stringify(result[index])+`</data>`);
									$(item).bind({
										click: function(){
											// 格式化数据
											var data = JSON.parse($(this).children("data").html());
											// 设置数据
											onClick(node, data, query);
											// 隐藏结果栏
											$(".typeahead__result").hide();
										}
									});
								});
							}
							return resultHtmlList;
						}
					}
				});

				$(input).bind({
					click: function(){
						if($(this).val() != "")
							$(this).trigger("input.typeahead");
					}
				});
			}

			function base64Img2Blob(code){
				var parts = code.split(';base64,');
				var contentType = parts[0].split(':')[1];
				var raw = window.atob(parts[1]);
				var rawLength = raw.length;

				var uInt8Array = new Uint8Array(rawLength);

				for (var i = 0; i < rawLength; ++i) {
					uInt8Array[i] = raw.charCodeAt(i);
				}

				return new Blob([uInt8Array], {type: contentType}); 
			}
		</script>

	</head>
	<body>
		<input id="staticResourceUploader" type="file" style="display:none;" onchange="uploadFile(this, function(src){layer.alert('资源路径为(仅限本系统使用): <a href='+src+' target=_block>'+src+'</a>');});" />
